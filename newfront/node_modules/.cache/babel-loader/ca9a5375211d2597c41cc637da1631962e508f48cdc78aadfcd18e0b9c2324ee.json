{"ast":null,"code":"import axios from\"axios\";import authHeader from\"./auth-header\";var API_URL=\"/api/auth/\";var checkTokenExpiration=function checkTokenExpiration(){/*\r\n  const loginTime = localStorage.getItem(\"loginTime\");\r\n  const currentTime = parseInt(Date.now());\r\n  const elapsedMilliseconds = currentTime - parseInt(loginTime);\r\n\r\n  const milisegundosEn24Horas = 24 * 60 * 60 * 1000;\r\n\r\n  if (elapsedMilliseconds >= milisegundosEn24Horas) {\r\n    // Ha pasado más de 24 horas, eliminar el usuario del local storage\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"loginTime\");\r\n  }\r\n\r\n  */localStorage.removeItem(\"user\");localStorage.removeItem(\"loginTime\");};var register=function register(username,password,teacher,role){return axios.post(API_URL+\"signup\",{username:username,password:password,teacher:teacher,role:role});};var login=function login(username,password){return axios.post(API_URL+\"signin\",{username:username,password:password}).then(function(response){if(response.data.accessToken){localStorage.setItem(\"user\",JSON.stringify(response.data));localStorage.setItem(\"loginTime\",Date.now());}return response.data;});};var logout=function logout(){localStorage.removeItem(\"user\");};var getCurrentUser=function getCurrentUser(){return JSON.parse(localStorage.getItem(\"user\"));};var getCurrentUserFromDB=function getCurrentUserFromDB(){var user=getCurrentUser();if(user&&user.accessToken){console.log(\"Entra al getCurrentuserFromDB\");return axios.get(API_URL+\"user\",{headers:{\"x-access-token\":user.accessToken}});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var getTeachers=function getTeachers(){return axios.get(API_URL+\"teachers\");};var getMyStudents=function getMyStudents(){var user=getCurrentUser();if(user&&user.accessToken){return axios.get(API_URL+\"students\",{headers:{\"x-access-token\":user.accessToken}});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var eraseStats=function eraseStats(){var user=getCurrentUser();if(user&&user.accessToken){return axios.post(API_URL+\"erase-stats\",null,{headers:authHeader()}).then(function(response){if(response.data.accessToken){localStorage.setItem(\"user\",JSON.stringify(response.data));}return response.data;});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var deleteAccountById=function deleteAccountById(){var user=getCurrentUser();if(user&&user.accessToken){return axios.delete(API_URL+\"delete-account-byid\",{headers:authHeader()}).then(function(){logout();// Cerrar sesión después de borrar la cuenta\n}).catch(function(error){console.error(\"Error borrando la cuenta:\",error);throw error;});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var deleteAccountByUsername=function deleteAccountByUsername(username){var user=getCurrentUser();if(user&&user.accessToken){return axios.delete(API_URL+\"delete-account-byUsername\",{headers:authHeader(),data:{username:username}}).then(function(response){return response.data;}).catch(function(error){console.error(\"Error borrando la cuenta:\",error);throw error;});}else{return Promise.reject(new Error(\"Usuario no encontrado o token expirado.\"));}};var AuthService={register:register,login:login,logout:logout,getCurrentUser:getCurrentUser,getCurrentUserFromDB:getCurrentUserFromDB,getTeachers:getTeachers,getMyStudents:getMyStudents,checkTokenExpiration:checkTokenExpiration,eraseStats:eraseStats,deleteAccountById:deleteAccountById,deleteAccountByUsername:deleteAccountByUsername};export default AuthService;","map":{"version":3,"names":["axios","authHeader","API_URL","checkTokenExpiration","localStorage","removeItem","register","username","password","teacher","role","post","login","then","response","data","accessToken","setItem","JSON","stringify","Date","now","logout","getCurrentUser","parse","getItem","getCurrentUserFromDB","user","console","log","get","headers","Promise","reject","Error","getTeachers","getMyStudents","eraseStats","deleteAccountById","delete","catch","error","deleteAccountByUsername","AuthService"],"sources":["C:/Users/jaime/TFGProto/newfront/src/services/auth.service.js"],"sourcesContent":["import axios from \"axios\";\r\nimport authHeader from \"./auth-header\";\r\n\r\nconst API_URL = \"/api/auth/\";\r\n\r\nconst checkTokenExpiration = () => {\r\n  /*\r\n  const loginTime = localStorage.getItem(\"loginTime\");\r\n  const currentTime = parseInt(Date.now());\r\n  const elapsedMilliseconds = currentTime - parseInt(loginTime);\r\n\r\n  const milisegundosEn24Horas = 24 * 60 * 60 * 1000;\r\n\r\n  if (elapsedMilliseconds >= milisegundosEn24Horas) {\r\n    // Ha pasado más de 24 horas, eliminar el usuario del local storage\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"loginTime\");\r\n  }\r\n\r\n  */\r\n  localStorage.removeItem(\"user\");\r\n  localStorage.removeItem(\"loginTime\");\r\n\r\n};\r\n\r\n\r\n\r\nconst register = (username, password, teacher, role) => {\r\n  return axios.post(API_URL + \"signup\", {\r\n    username,\r\n    password,\r\n    teacher,\r\n    role,\r\n  });\r\n};\r\n\r\nconst login = (username, password) => {\r\n  return axios\r\n    .post(API_URL + \"signin\", {\r\n      username,\r\n      password,\r\n    })\r\n    .then((response) => {\r\n      if (response.data.accessToken) {\r\n        localStorage.setItem(\"user\", JSON.stringify(response.data));\r\n        localStorage.setItem(\"loginTime\", Date.now())\r\n      }\r\n\r\n      return response.data;\r\n    });\r\n};\r\n\r\nconst logout = () => {\r\n  localStorage.removeItem(\"user\");\r\n};\r\n\r\nconst getCurrentUser = () => {\r\n  return JSON.parse(localStorage.getItem(\"user\"));\r\n};\r\n\r\nconst getCurrentUserFromDB = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    console.log(\"Entra al getCurrentuserFromDB\")\r\n    return axios.get(API_URL + \"user\", {\r\n      headers: { \"x-access-token\": user.accessToken },\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\nconst getTeachers = () => {\r\n  return axios.get(API_URL + \"teachers\");\r\n}\r\n\r\nconst getMyStudents = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.get(API_URL + \"students\", {\r\n      headers: { \"x-access-token\": user.accessToken },\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n}\r\n\r\nconst eraseStats = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.post(API_URL + \"erase-stats\", null, {\r\n      headers: authHeader(),\r\n    })\r\n    .then((response) => {\r\n      if (response.data.accessToken) {\r\n        localStorage.setItem(\"user\", JSON.stringify(response.data));\r\n      }\r\n\r\n      return response.data;\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\n\r\nconst deleteAccountById = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.delete(API_URL + \"delete-account-byid\", {\r\n      headers: authHeader(),\r\n    })\r\n    .then(() => {\r\n      logout(); // Cerrar sesión después de borrar la cuenta\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error borrando la cuenta:\", error);\r\n      throw error;\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\nconst deleteAccountByUsername = (username) => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios\r\n      .delete(API_URL + \"delete-account-byUsername\", {\r\n        headers: authHeader(),\r\n        data: { username },\r\n      })\r\n      .then((response) => {\r\n        return response.data;\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error borrando la cuenta:\", error);\r\n        throw error;\r\n      });\r\n  } else {\r\n    return Promise.reject(new Error(\"Usuario no encontrado o token expirado.\"));\r\n  }\r\n};\r\n\r\n\r\nconst AuthService = {\r\n  register,\r\n  login,\r\n  logout,\r\n  getCurrentUser,\r\n  getCurrentUserFromDB,\r\n  getTeachers,\r\n  getMyStudents,\r\n  checkTokenExpiration,\r\n  eraseStats,\r\n  deleteAccountById,\r\n  deleteAccountByUsername,\r\n\r\n};\r\n\r\nexport default AuthService;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}