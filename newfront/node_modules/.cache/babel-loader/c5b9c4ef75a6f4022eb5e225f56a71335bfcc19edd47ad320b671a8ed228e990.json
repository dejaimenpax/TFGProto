{"ast":null,"code":"import axios from\"axios\";import authHeader from\"./auth-header\";var API_URL=\"/api/auth/\";var checkTokenExpiration=function checkTokenExpiration(){var loginTime=localStorage.getItem(\"loginTime\");var currentTime=Date.now();var elapsedMilliseconds=currentTime-parseInt(loginTime);var elapsedHours=elapsedMilliseconds/(1000*60*60);if(elapsedHours>=24){// Ha pasado más de 24 horas, eliminar el usuario del local storage\nlocalStorage.removeItem(\"user\");localStorage.removeItem(\"loginTime\");}};var register=function register(username,password,teacher,role){return axios.post(API_URL+\"signup\",{username:username,password:password,teacher:teacher,role:role});};var login=function login(username,password){return axios.post(API_URL+\"signin\",{username:username,password:password}).then(function(response){if(response.data.accessToken){localStorage.setItem(\"user\",JSON.stringify(response.data));localStorage.setItem(\"loginTime\",Date.now());}return response.data;});};var logout=function logout(){localStorage.removeItem(\"user\");};var getCurrentUser=function getCurrentUser(){return JSON.parse(localStorage.getItem(\"user\"));};var getCurrentUserFromDB=function getCurrentUserFromDB(){var user=getCurrentUser();if(user&&user.accessToken){console.log(\"Entra al getCurrentuserFromDB\");return axios.get(API_URL+\"user\",{headers:{\"x-access-token\":user.accessToken}});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var getTeachers=function getTeachers(){return axios.get(API_URL+\"teachers\");};var getMyStudents=function getMyStudents(){var user=getCurrentUser();if(user&&user.accessToken){return axios.get(API_URL+\"students\",{headers:{\"x-access-token\":user.accessToken}});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var eraseStats=function eraseStats(){var user=getCurrentUser();if(user&&user.accessToken){return axios.post(API_URL+\"erase-stats\",null,{headers:authHeader()}).then(function(response){if(response.data.accessToken){localStorage.setItem(\"user\",JSON.stringify(response.data));}return response.data;});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var deleteAccountById=function deleteAccountById(){var user=getCurrentUser();if(user&&user.accessToken){return axios.delete(API_URL+\"delete-account-byid\",{headers:authHeader()}).then(function(){logout();// Cerrar sesión después de borrar la cuenta\n}).catch(function(error){console.error(\"Error borrando la cuenta:\",error);throw error;});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var deleteAccountByUsername=function deleteAccountByUsername(username){var user=getCurrentUser();if(user&&user.accessToken){return axios.delete(API_URL+\"delete-account-byUsername\",{headers:authHeader(),data:{username:username}}).then(function(response){return response.data;}).catch(function(error){console.error(\"Error borrando la cuenta:\",error);throw error;});}else{return Promise.reject(new Error(\"Usuario no encontrado o token expirado.\"));}};var getAllUsersExceptAdmins=function getAllUsersExceptAdmins(){return axios.get(API_URL+\"all-users\",{headers:authHeader()});};var AuthService={register:register,login:login,logout:logout,getCurrentUser:getCurrentUser,getCurrentUserFromDB:getCurrentUserFromDB,getTeachers:getTeachers,getMyStudents:getMyStudents,checkTokenExpiration:checkTokenExpiration,eraseStats:eraseStats,deleteAccountById:deleteAccountById,getAllUsersExceptAdmins:getAllUsersExceptAdmins,deleteAccountByUsername:deleteAccountByUsername};export default AuthService;","map":{"version":3,"names":["axios","authHeader","API_URL","checkTokenExpiration","loginTime","localStorage","getItem","currentTime","Date","now","elapsedMilliseconds","parseInt","elapsedHours","removeItem","register","username","password","teacher","role","post","login","then","response","data","accessToken","setItem","JSON","stringify","logout","getCurrentUser","parse","getCurrentUserFromDB","user","console","log","get","headers","Promise","reject","Error","getTeachers","getMyStudents","eraseStats","deleteAccountById","delete","catch","error","deleteAccountByUsername","getAllUsersExceptAdmins","AuthService"],"sources":["C:/Users/jaime/TFGProto/newfront/src/services/auth.service.js"],"sourcesContent":["import axios from \"axios\";\r\nimport authHeader from \"./auth-header\";\r\n\r\nconst API_URL = \"/api/auth/\";\r\n\r\nconst checkTokenExpiration = () => {\r\n  const loginTime = localStorage.getItem(\"loginTime\");\r\n  const currentTime = Date.now();\r\n  const elapsedMilliseconds = currentTime - parseInt(loginTime);\r\n\r\n  const elapsedHours = elapsedMilliseconds / (1000 * 60 * 60);\r\n\r\n  if (elapsedHours >= 24) {\r\n    // Ha pasado más de 24 horas, eliminar el usuario del local storage\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"loginTime\");\r\n  }\r\n};\r\n\r\n\r\n\r\nconst register = (username, password, teacher, role) => {\r\n  return axios.post(API_URL + \"signup\", {\r\n    username,\r\n    password,\r\n    teacher,\r\n    role,\r\n  });\r\n};\r\n\r\nconst login = (username, password) => {\r\n  return axios\r\n    .post(API_URL + \"signin\", {\r\n      username,\r\n      password,\r\n    })\r\n    .then((response) => {\r\n      if (response.data.accessToken) {\r\n        localStorage.setItem(\"user\", JSON.stringify(response.data));\r\n        localStorage.setItem(\"loginTime\", Date.now())\r\n      }\r\n\r\n      return response.data;\r\n    });\r\n};\r\n\r\nconst logout = () => {\r\n  localStorage.removeItem(\"user\");\r\n};\r\n\r\nconst getCurrentUser = () => {\r\n  return JSON.parse(localStorage.getItem(\"user\"));\r\n};\r\n\r\nconst getCurrentUserFromDB = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    console.log(\"Entra al getCurrentuserFromDB\")\r\n    return axios.get(API_URL + \"user\", {\r\n      headers: { \"x-access-token\": user.accessToken },\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\nconst getTeachers = () => {\r\n  return axios.get(API_URL + \"teachers\");\r\n}\r\n\r\nconst getMyStudents = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.get(API_URL + \"students\", {\r\n      headers: { \"x-access-token\": user.accessToken },\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n}\r\n\r\nconst eraseStats = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.post(API_URL + \"erase-stats\", null, {\r\n      headers: authHeader(),\r\n    })\r\n    .then((response) => {\r\n      if (response.data.accessToken) {\r\n        localStorage.setItem(\"user\", JSON.stringify(response.data));\r\n      }\r\n\r\n      return response.data;\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\n\r\nconst deleteAccountById = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.delete(API_URL + \"delete-account-byid\", {\r\n      headers: authHeader(),\r\n    })\r\n    .then(() => {\r\n      logout(); // Cerrar sesión después de borrar la cuenta\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error borrando la cuenta:\", error);\r\n      throw error;\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\nconst deleteAccountByUsername = (username) => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios\r\n      .delete(API_URL + \"delete-account-byUsername\", {\r\n        headers: authHeader(),\r\n        data: { username },\r\n      })\r\n      .then((response) => {\r\n        return response.data;\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error borrando la cuenta:\", error);\r\n        throw error;\r\n      });\r\n  } else {\r\n    return Promise.reject(new Error(\"Usuario no encontrado o token expirado.\"));\r\n  }\r\n};\r\n\r\nconst getAllUsersExceptAdmins = () => {\r\n  return axios.get(API_URL + \"all-users\", { headers: authHeader() });\r\n};\r\n\r\nconst AuthService = {\r\n  register,\r\n  login,\r\n  logout,\r\n  getCurrentUser,\r\n  getCurrentUserFromDB,\r\n  getTeachers,\r\n  getMyStudents,\r\n  checkTokenExpiration,\r\n  eraseStats,\r\n  deleteAccountById,\r\n  getAllUsersExceptAdmins,\r\n  deleteAccountByUsername,\r\n\r\n};\r\n\r\nexport default AuthService;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}