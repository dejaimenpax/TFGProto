{"ast":null,"code":"import axios from\"axios\";var API_URL=\"/api/auth/\";var checkTokenExpiration=function checkTokenExpiration(){var loginTime=localStorage.getItem(\"loginTime\");var currentTime=Date.now();var elapsedMilliseconds=currentTime-parseInt(loginTime);var elapsedHours=elapsedMilliseconds/(1000*60*60);if(elapsedHours>=24){// Ha pasado más de 24 horas, eliminar el usuario del local storage\nlocalStorage.removeItem(\"user\");localStorage.removeItem(\"loginTime\");}};var register=function register(email,password,teacher,role){return axios.post(API_URL+\"signup\",{email:email,password:password,teacher:teacher,role:role});};var login=function login(email,password){return axios.post(API_URL+\"signin\",{email:email,password:password}).then(function(response){if(response.data.accessToken){localStorage.setItem(\"user\",JSON.stringify(response.data));localStorage.setItem(\"loginTime\",Date.now());}return response.data;});};var logout=function logout(){localStorage.removeItem(\"user\");};var getCurrentUser=function getCurrentUser(){return JSON.parse(localStorage.getItem(\"user\"));};var getCurrentUserFromDB=function getCurrentUserFromDB(){var user=getCurrentUser();if(user&&user.accessToken){console.log(\"Entra al getCurrentuserFromDB\");return axios.get(API_URL+\"user\",{headers:{\"x-access-token\":user.accessToken}});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var getTeachers=function getTeachers(){return axios.get(API_URL+\"teachers\");};var getMyStudents=function getMyStudents(){var user=getCurrentUser();if(user&&user.accessToken){return axios.get(API_URL+\"students\",{headers:{\"x-access-token\":user.accessToken}});}else{return Promise.reject(new Error(\"User not found or token expired\"));}};var AuthService={register:register,login:login,logout:logout,getCurrentUser:getCurrentUser,getCurrentUserFromDB:getCurrentUserFromDB,getTeachers:getTeachers,getMyStudents:getMyStudents};export default AuthService;","map":{"version":3,"names":["axios","API_URL","checkTokenExpiration","loginTime","localStorage","getItem","currentTime","Date","now","elapsedMilliseconds","parseInt","elapsedHours","removeItem","register","email","password","teacher","role","post","login","then","response","data","accessToken","setItem","JSON","stringify","logout","getCurrentUser","parse","getCurrentUserFromDB","user","console","log","get","headers","Promise","reject","Error","getTeachers","getMyStudents","AuthService"],"sources":["C:/Users/jaime/TFGProto/newfront/src/services/auth.service.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst API_URL = \"/api/auth/\";\r\n\r\nconst checkTokenExpiration = () => {\r\n  const loginTime = localStorage.getItem(\"loginTime\");\r\n  const currentTime = Date.now();\r\n  const elapsedMilliseconds = currentTime - parseInt(loginTime);\r\n\r\n  const elapsedHours = elapsedMilliseconds / (1000 * 60 * 60);\r\n\r\n  if (elapsedHours >= 24) {\r\n    // Ha pasado más de 24 horas, eliminar el usuario del local storage\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"loginTime\");\r\n  }\r\n};\r\n\r\n\r\n\r\nconst register = (email, password, teacher, role) => {\r\n  return axios.post(API_URL + \"signup\", {\r\n    email,\r\n    password,\r\n    teacher,\r\n    role,\r\n  });\r\n};\r\n\r\nconst login = (email, password) => {\r\n  return axios\r\n    .post(API_URL + \"signin\", {\r\n      email,\r\n      password,\r\n    })\r\n    .then((response) => {\r\n      if (response.data.accessToken) {\r\n        localStorage.setItem(\"user\", JSON.stringify(response.data));\r\n        localStorage.setItem(\"loginTime\", Date.now())\r\n      }\r\n\r\n      return response.data;\r\n    });\r\n};\r\n\r\nconst logout = () => {\r\n  localStorage.removeItem(\"user\");\r\n};\r\n\r\nconst getCurrentUser = () => {\r\n  return JSON.parse(localStorage.getItem(\"user\"));\r\n};\r\n\r\nconst getCurrentUserFromDB = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    console.log(\"Entra al getCurrentuserFromDB\")\r\n    return axios.get(API_URL + \"user\", {\r\n      headers: { \"x-access-token\": user.accessToken },\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n};\r\n\r\nconst getTeachers = () => {\r\n  return axios.get(API_URL + \"teachers\");\r\n}\r\n\r\nconst getMyStudents = () => {\r\n  const user = getCurrentUser();\r\n  if (user && user.accessToken) {\r\n    return axios.get(API_URL + \"students\", {\r\n      headers: { \"x-access-token\": user.accessToken },\r\n    });\r\n  } else {\r\n    return Promise.reject(new Error(\"User not found or token expired\"));\r\n  }\r\n}\r\n\r\nconst AuthService = {\r\n  register,\r\n  login,\r\n  logout,\r\n  getCurrentUser,\r\n  getCurrentUserFromDB,\r\n  getTeachers,\r\n  getMyStudents,\r\n};\r\n\r\nexport default AuthService;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}