{"ast":null,"code":"import _objectSpread from\"C:/Users/jaime/TFGProto/newfront/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/jaime/TFGProto/newfront/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import AuthService from\"../../services/auth.service\";import GestionService from\"../../services/gestion.service\";import EventBus from\"../../common/EventBus\";import\"../../styles/UserBoards/Ranking.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Ranking=function Ranking(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),students=_useState2[0],setStudents=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),teacher=_useState4[0],setTeacher=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showRanking=_useState8[0],setShowRanking=_useState8[1];useEffect(function(){fetchStudentsWithSameTeacher();AuthService.getCurrentUserFromDB().then(function(response){setUser(response.data);}).catch(function(error){if(error.response&&error.response.status===401){EventBus.dispatch(\"logout\");}});myTeacher();},[]);var fetchStudentsWithSameTeacher=function fetchStudentsWithSameTeacher(){AuthService.getStudentsWithSameTeacher().then(function(response){setStudents(response.data);}).catch(function(error){console.log(error);});};var myTeacher=function myTeacher(){AuthService.getMyTeacher().then(function(response){setTeacher(response.data);setShowRanking(response.data.flag_ranking);console.log(\"Se ejecuta el getMyTeacher y se recibe el flag a \"+response.data.flag_ranking);}).catch(function(error){if(error.response&&error.response.status===401){EventBus.dispatch(\"logout\");}});};var handleShowRanking=function handleShowRanking(flag){var teacher_updated=_objectSpread(_objectSpread({},teacher),{},{flag_ranking:flag});console.log(\"El flag una vez entra en el handleShowRanking es \"+flag);GestionService.updateRankingVisibility(teacher_updated,flag).then(function(){setShowRanking(flag);setTeacher(teacher_updated);console.log(\"Dentro del hableShowRanking se ha puesto el flag a \"+flag+\". Vuelvo a llamar al getMyTeachers\");}).catch(function(error){return console.error(\"Error actualizando la visibilidad del ranking:\",error);});myTeacher();};return/*#__PURE__*/_jsxs(\"div\",{className:\"container text-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-center mt-4\",children:\"Ranking de alumnos\"}),(user===null||user===void 0?void 0:user.username)===(user===null||user===void 0?void 0:user.teacher)&&/*#__PURE__*/_jsxs(\"div\",{className:\"gray-box\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:teacher.flag_ranking,onChange:function onChange(e){handleShowRanking(e.target.checked);console.log(\"Una vez sale del handle, si consultamos a teacher el flag es \"+teacher[0].flag_ranking);console.log(\"Una vez sale del handle, y si consultamos a showRanking es  \"+showRanking);}}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:\"Ocultar Ranking a los alumnos\"})]}),showRanking&&(user===null||user===void 0?void 0:user.username)!==(teacher===null||teacher===void 0?void 0:teacher.username)&&/*#__PURE__*/_jsxs(\"table\",{className:\"table mt-2\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Posici\\xF3n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Usuario\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Puntuaci\\xF3n\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:students.map(function(student,index){return/*#__PURE__*/_jsxs(\"tr\",{className:index===0?\"gold\":index===1?\"silver\":index===2?\"bronze\":\"\",children:[/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsxs(\"td\",{children:[index===0&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDD47 \",student.username]}),index===1&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDD48 \",student.username]}),index===2&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDD49 \",student.username]}),index>=3&&student.username]}),/*#__PURE__*/_jsx(\"td\",{children:student.scores.reduce(function(acc,score){return acc+score;},0).toString().replace('.',',')})]},index);})})]}),(user===null||user===void 0?void 0:user.username)===(teacher===null||teacher===void 0?void 0:teacher.username)&&/*#__PURE__*/_jsxs(\"table\",{className:\"table mt-2\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Posici\\xF3n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Usuario\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Puntuaci\\xF3n\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:students.map(function(student,index){return/*#__PURE__*/_jsxs(\"tr\",{className:index===0?\"gold\":index===1?\"silver\":index===2?\"bronze\":\"\",children:[/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsxs(\"td\",{children:[index===0&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDD47 \",student.username]}),index===1&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDD48 \",student.username]}),index===2&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDD49 \",student.username]}),index>=3&&student.username]}),/*#__PURE__*/_jsx(\"td\",{children:student.scores.reduce(function(acc,score){return acc+score;},0).toString().replace('.',',')})]},index);})})]})]});};export default Ranking;","map":{"version":3,"names":["React","useState","useEffect","AuthService","GestionService","EventBus","Ranking","students","setStudents","teacher","setTeacher","user","setUser","showRanking","setShowRanking","fetchStudentsWithSameTeacher","getCurrentUserFromDB","then","response","data","catch","error","status","dispatch","myTeacher","getStudentsWithSameTeacher","console","log","getMyTeacher","flag_ranking","handleShowRanking","flag","teacher_updated","updateRankingVisibility","username","e","target","checked","map","student","index","scores","reduce","acc","score","toString","replace"],"sources":["C:/Users/jaime/TFGProto/newfront/src/components/UserBoards/Ranking.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport AuthService from \"../../services/auth.service\";\r\nimport GestionService from \"../../services/gestion.service\";\r\nimport EventBus from \"../../common/EventBus\";\r\nimport \"../../styles/UserBoards/Ranking.css\";\r\n\r\nconst Ranking = () => {\r\n    const [students, setStudents] = useState([]);\r\n    const [teacher, setTeacher] = useState();\r\n    const [user, setUser] = useState(null);\r\n    const [showRanking, setShowRanking] = useState(false)\r\n\r\n    useEffect(() => {\r\n        fetchStudentsWithSameTeacher();\r\n\r\n        AuthService.getCurrentUserFromDB()\r\n        .then((response) => {\r\n          setUser(response.data);\r\n        })\r\n        .catch((error) => {\r\n          if (error.response && error.response.status === 401) {\r\n            EventBus.dispatch(\"logout\");\r\n          }\r\n        });\r\n\r\n        myTeacher();\r\n\r\n    }, []);\r\n\r\n    const fetchStudentsWithSameTeacher = () => {\r\n        AuthService.getStudentsWithSameTeacher()\r\n            .then((response) => {\r\n                setStudents(response.data);\r\n            })\r\n            .catch((error) => {\r\n                console.log(error);\r\n            });\r\n    };\r\n\r\n    const myTeacher = () => {\r\n        AuthService.getMyTeacher()\r\n        .then((response) => {\r\n          setTeacher(response.data);\r\n          setShowRanking(response.data.flag_ranking)\r\n          console.log(\"Se ejecuta el getMyTeacher y se recibe el flag a \" + response.data.flag_ranking )\r\n        })\r\n        .catch((error) => {\r\n          if (error.response && error.response.status === 401) {\r\n            EventBus.dispatch(\"logout\");\r\n          }\r\n        });\r\n    }\r\n\r\n    const handleShowRanking = (flag) => {\r\n        const teacher_updated = { ...teacher, flag_ranking: flag }\r\n\r\n        console.log(\"El flag una vez entra en el handleShowRanking es \" + flag)\r\n        GestionService.updateRankingVisibility(teacher_updated, flag)\r\n          .then(() => {\r\n            setShowRanking(flag)\r\n            setTeacher(teacher_updated)\r\n            console.log(\"Dentro del hableShowRanking se ha puesto el flag a \" + flag+ \". Vuelvo a llamar al getMyTeachers\")\r\n          })\r\n          .catch((error) =>\r\n            console.error(\"Error actualizando la visibilidad del ranking:\", error)\r\n          );\r\n          myTeacher();\r\n    };\r\n\r\n    return (\r\n        <div className=\"container text-center\">\r\n            <h3 className=\"text-center mt-4\">Ranking de alumnos</h3>\r\n            {user?.username===user?.teacher && (\r\n                <div className=\"gray-box\">\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        checked={teacher.flag_ranking}\r\n                        onChange={(e) =>{\r\n                            handleShowRanking(e.target.checked)\r\n                            console.log(\"Una vez sale del handle, si consultamos a teacher el flag es \" + teacher[0].flag_ranking)\r\n                            console.log(\"Una vez sale del handle, y si consultamos a showRanking es  \" + showRanking)\r\n                            }\r\n                        }\r\n                    />\r\n                    <span className=\"ml-2\">Ocultar Ranking a los alumnos</span>\r\n                </div>\r\n            )}\r\n\r\n            {showRanking && user?.username!==teacher?.username && (\r\n            <table className=\"table mt-2\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Posición</th>\r\n                        <th>Usuario</th>\r\n                        <th>Puntuación</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {students.map((student, index) => (\r\n                        <tr\r\n                            key={index}\r\n                            className={\r\n                                index === 0\r\n                                    ? \"gold\"\r\n                                    : index === 1\r\n                                    ? \"silver\"\r\n                                    : index === 2\r\n                                    ? \"bronze\"\r\n                                    : \"\"\r\n                            }\r\n                        >\r\n                            <td>{index + 1}</td>\r\n                            <td>\r\n                                {index === 0 && <>🥇 {student.username}</>}\r\n                                {index === 1 && <>🥈 {student.username}</>}\r\n                                {index === 2 && <>🥉 {student.username}</>}\r\n                                {index >= 3 && student.username}\r\n                            </td>\r\n                            <td>{student.scores.reduce((acc, score) => acc + score, 0).toString().replace('.',',')}</td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>)}\r\n\r\n            {user?.username===teacher?.username && (\r\n            <table className=\"table mt-2\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Posición</th>\r\n                        <th>Usuario</th>\r\n                        <th>Puntuación</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {students.map((student, index) => (\r\n                        <tr\r\n                            key={index}\r\n                            className={\r\n                                index === 0\r\n                                    ? \"gold\"\r\n                                    : index === 1\r\n                                    ? \"silver\"\r\n                                    : index === 2\r\n                                    ? \"bronze\"\r\n                                    : \"\"\r\n                            }\r\n                        >\r\n                            <td>{index + 1}</td>\r\n                            <td>\r\n                                {index === 0 && <>🥇 {student.username}</>}\r\n                                {index === 1 && <>🥈 {student.username}</>}\r\n                                {index === 2 && <>🥉 {student.username}</>}\r\n                                {index >= 3 && student.username}\r\n                            </td>\r\n                            <td>{student.scores.reduce((acc, score) => acc + score, 0).toString().replace('.',',')}</td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>)}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Ranking;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}